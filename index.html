const { Connection, PublicKey, Keypair, Transaction, sendAndConfirmTransaction } = solanaWeb3;
const { Token, TOKEN_PROGRAM_ID } = splToken;

let connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");
let wallet = null;

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¨ÙƒØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function updateNetwork() {
    let selectedNetwork = document.getElementById("networkSelector").value;
    connection = new Connection(
        selectedNetwork === "mainnet-beta"
            ? "https://api.mainnet-beta.solana.com"
            : "https://api.testnet.solana.com",
        "confirmed"
    );
    document.getElementById("status").innerText = `âœ… Switched to ${selectedNetwork}`;
}

// ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø©
async function connectWallet() {
    try {
        if (!window.solana || !window.solana.isPhantom) {
            alert("ğŸš¨ ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Ù…Ø­ÙØ¸Ø© Phantom Wallet!");
            return;
        }
        wallet = window.solana;
        const response = await wallet.connect();
        document.getElementById("walletStatus").innerText = `âœ… Ù…ØªØµÙ„: ${response.publicKey.toBase58()}`;
    } catch (error) {
        console.error(error);
        document.getElementById("walletStatus").innerText = "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø©.";
    }
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ† ÙØ¹Ù„ÙŠÙ‹Ø§
async function createToken() {
    if (!wallet || !wallet.publicKey) {
        alert("âŒ ÙŠØ±Ø¬Ù‰ ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹.");
        return;
    }

    try {
        document.getElementById("loading").style.display = "block";
        document.getElementById("status").innerText = "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†...";

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        const tokenName = document.getElementById("tokenName").value.trim();
        const tokenSymbol = document.getElementById("tokenSymbol").value.trim();
        const decimals = parseInt(document.getElementById("decimals").value);
        const supply = parseInt(document.getElementById("supply").value);

        if (!tokenName || !tokenSymbol || !supply) {
            alert("âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!");
            document.getElementById("loading").style.display = "none";
            return;
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ÙŠÙ†Øª (Mint Account)
        const mintAccount = Keypair.generate();

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†
        const token = await Token.createMint(
            connection,
            wallet,
            wallet.publicKey, // Authority
            null, // Freeze authority
            decimals,
            mintAccount,
            TOKEN_PROGRAM_ID
        );

        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù„Ù„Ø­ÙŠØ§Ø²Ø©
        const tokenAccount = await token.getOrCreateAssociatedAccountInfo(wallet.publicKey);

        // Ø³Ùƒ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª (Mint Tokens)
        await token.mintTo(
            tokenAccount.address,
            wallet.publicKey,
            [],
            supply * Math.pow(10, decimals) // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ÙˆØ­Ø¯Ø§Øª Ø£ØµØºØ±
        );

        document.getElementById("loading").style.display = "none";
        document.getElementById("status").innerHTML = `âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ù†Ø¬Ø§Ø­!<br>Mint Address: <b>${mintAccount.publicKey.toBase58()}</b>`;
    } catch (error) {
        console.error(error);
        document.getElementById("loading").style.display = "none";
        document.getElementById("status").innerText = "âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†!";
    }
}
